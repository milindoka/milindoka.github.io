<!DOCTYPE html>
<html>
<head>
<style>
/* CSS is unchanged, but included for context */
.c1 {
    position: absolute;
    height: 25px;
    width: 200px;
    top: 100px;
    left: 200px;
    opacity: 0.0;
    transition: top 1s, opacity 1s; /* Add transitions for the animated properties */
}
.c2 {
    position: absolute;
    height: 25px;
    width: 200px;
    top: 150px;
    left: 200px;
    opacity: 0.5;
    transition: top 1s, opacity 1s;
}
.c3 {
    position: absolute;
    height: 25px;
    width: 200px;
    top: 200px;
    left: 200px;
    opacity: 1.0;
    transition: top 1s, opacity 1s;
}
.c4 {
    position: absolute;
    height: 25px;
    width: 200px;
    top: 250px;
    left: 200px;
    opacity: 0.5;
    transition: top 1s, opacity 1s;
}
.c5 {
    position: absolute;
    height: 25px;
    width: 200px;
    top: 300px;
    left: 200px;
    opacity: 0.0;
    transition: top 1s, opacity 1s;
}
.c12 {
    position: absolute;
    height: 25px;
    width: 200px;
    top: 150px;
    left: 200px;
    opacity: 0.5;
    visibility: hidden;
}
.c13 {
    position: absolute;
    height: 25px;
    width: 200px;
    top: 200px;
    left: 200px;
    opacity: 1.0;
    visibility: hidden;
}
.c14 {
    position: absolute;
    height: 25px;
    width: 200px;
    top: 250px;
    left: 200px;
    opacity: 0.5;
    visibility: hidden;
}
</style>
</head>
<body>
<button>Start Animation</button>
<div class="c1" id="child1">Number 10</div>
<div class="c2" id="child2">Number 11</div>
<div class="c3" id="child3">Number 12</div>
<div class="c4" id="child4">Number 13</div>
<div class="c5" id="child5">Number 14</div>
<div class="c1" id="child11">Number 10</div>
<div class="c12" id="child12">Number 11</div>
<div class="c13" id="child13">Number 12</div>
<div class="c14" id="child14">Number 13</div>
<div class="c5" id="child15">Number 14</div>

<script>
let topindex = 0;
let animrunning = false; // Use a boolean instead of 0/1
const arr = [];
for (let i = 10; i <= 30; i++) {
    arr.push('Number ' + i.toString());
}
const len = arr.length;

// This function will be called once the animation is complete.
function handleTransitionEnd() {
    newval();
    // Remove the event listener to avoid repeated calls
    document.getElementById("child5").removeEventListener("transitionend", handleTransitionEnd);
}

document.addEventListener("DOMContentLoaded", function() {
    const button = document.querySelector("button");

    button.addEventListener("click", function() {
        if (animrunning) return;
        animrunning = true;

        document.getElementById("child12").style.visibility = "hidden";
        document.getElementById("child13").style.visibility = "hidden";
        document.getElementById("child14").style.visibility = "hidden";

        // Add the transitionend event listener BEFORE starting the animation
        document.getElementById("child5").addEventListener("transitionend", handleTransitionEnd);

        // Apply new styles to trigger the CSS transition
        const child2 = document.getElementById("child2");
        const child3 = document.getElementById("child3");
        const child4 = document.getElementById("child4");
        const child5 = document.getElementById("child5");

        child2.style.top = '100px';
        child2.style.opacity = '0.0';

        child3.style.top = '150px';
        child3.style.opacity = '0.5';

        child4.style.top = '200px';
        child4.style.opacity = '1.0';

        child5.style.top = '250px';
        child5.style.opacity = '0.5';
    });
});

function newval() {
    document.getElementById("child2").style.visibility = "hidden";
    document.getElementById("child3").style.visibility = "hidden";
    document.getElementById("child4").style.visibility = "hidden";
    document.getElementById("child5").style.visibility = "hidden";

    topindex++;

    document.getElementById("child1").innerHTML = arr[topindex % len];
    document.getElementById("child2").innerHTML = arr[(topindex + 1) % len];
    document.getElementById("child3").innerHTML = arr[(topindex + 2) % len];
    document.getElementById("child4").innerHTML = arr[(topindex + 3) % len];
    document.getElementById("child5").innerHTML = arr[(topindex + 4) % len];

    document.getElementById("child11").innerHTML = arr[topindex % len];
    document.getElementById("child12").innerHTML = arr[(topindex + 1) % len];
    document.getElementById("child13").innerHTML = arr[(topindex + 2) % len];
    document.getElementById("child14").innerHTML = arr[(topindex + 3) % len];
    document.getElementById("child15").innerHTML = arr[(topindex + 4) % len];

    resetAnim();
}

function resetAnim() {
    document.getElementById("child12").style.opacity = 0.5;
    document.getElementById("child13").style.opacity = 1.0;
    document.getElementById("child14").style.opacity = 0.5;

    document.getElementById("child12").style.visibility = "visible";
    document.getElementById("child13").style.visibility = "visible";
    document.getElementById("child14").style.visibility = "visible";
    
    // Use setTimeout to ensure the styles are applied and the animation starts
    setTimeout(() => {
        const child2 = document.getElementById("child2");
        const child3 = document.getElementById("child3");
        const child4 = document.getElementById("child4");
        const child5 = document.getElementById("child5");

        child2.style.top = '150px';
        child2.style.opacity = '0.5';

        child3.style.top = '200px';
        child3.style.opacity = '1.0';

        child4.style.top = '250px';
        child4.style.opacity = '0.5';

        child5.style.top = '300px';
        child5.style.opacity = '0';
        
        // Listen for the end of this animation to call setVisible
        child5.addEventListener("transitionend", setVisible, { once: true });
    }, 10);
}

function setVisible() {
    document.getElementById("child2").style.visibility = "visible";
    document.getElementById("child3").style.visibility = "visible";
    document.getElementById("child4").style.visibility = "visible";
    document.getElementById("child5").style.visibility = "visible";

    document.getElementById("child12").style.visibility = "hidden";
    document.getElementById("child13").style.visibility = "hidden";
    document.getElementById("child14").style.visibility = "hidden";
    
    // Reset the animation lock
    animrunning = false;
}
</script>
</body>
</html>
