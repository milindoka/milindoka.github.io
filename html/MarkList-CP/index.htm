<!DOCTYPE html>  
<html>  
<head>  
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="jquery-3-7-1.js"></script>  
<script>   
var topindex=0;   ///centre line index
var start='M03001';
var end='M03020';

let animrunning=0;
 var arr = [];
 
tempstart=start;
////  fill roll array
for(jj=0;jj<160;jj++)  {arr.push(tempstart);  if(tempstart==end)  break;  tempstart=IncrementAlphanumeric(tempstart); }

var len=arr.length;        

 for (var i = 0; i < len; i++) 
  {  arr[i]=arr[i]+' : ';
     // window.alert(arr[i]);
    }
    
window.addEventListener('load', InitRoll);
//InitRoll();
  
      //  $(child5).promise().done(newval);
    // will be called when all the animations on the queue finish

$(document).ready(function(){  
    $("button").click(function(){ 

      if(animrunning==1) return;   
          animrunning=1;
          
    document.getElementById("child11").style.visibility = "hidden";    
    document.getElementById("child12").style.visibility = "hidden";
    document.getElementById("child13").style.visibility = "hidden";
    document.getElementById("child14").style.visibility = "hidden";
    document.getElementById("child15").style.visibility = "hidden";
    document.getElementById("child16").style.visibility = "hidden";
 
        $("#child1").animate({top: '0vw',opacity:0.0}); 
        $("#child2").animate({top: '10vw',opacity:0.1});  
        $("#child3").animate({top: '20vw',opacity:0.3});  
        $("#child4").animate({top: '30vw',opacity:1.0});  
        $("#child5").animate({top: '40vw',opacity:0.3});  
         $("#child6").animate({top: '50vw',opacity:0.1});      
           topindex=(topindex+1)%len;            
        $(child6).promise().done(newval);
    });  
});  


function newval()
{        
                                            document.getElementById("child0").style.visibility = "hidden";
                                            document.getElementById("child1").style.visibility = "hidden";
                                             document.getElementById("child2").style.visibility = "hidden";
					     document.getElementById("child3").style.visibility = "hidden";
					     document.getElementById("child4").style.visibility = "hidden";
					      document.getElementById("child5").style.visibility = "hidden";
					      document.getElementById("child6").style.visibility = "hidden";
	
	                                    prev1=topindex-1; prev2=topindex-2;   prev3=topindex-3;                               
                                          if(topindex==0) {prev1=len-1; prev2=len-2; prev3=len-3;}
                                          if(topindex==1) {prev2=len-2; prev3=len-3;}
       				          if(topindex==2)   { prev3=len-3;}
                 //                                   topindex++;   
                                          document.getElementById("child0").innerHTML = arr[prev3]; 
                                          document.getElementById("child1").innerHTML = arr[prev2]; 
                                          document.getElementById("child2").innerHTML = arr[prev1]; 
                                          document.getElementById("child3").innerHTML = arr[topindex]; 
                                          document.getElementById("child4").innerHTML = arr[(topindex+1)%len]; 
                                          document.getElementById("child5").innerHTML = arr[(topindex+2)%len];    
                                         document.getElementById("child6").innerHTML =  arr[(topindex+3)%len];   
                                          
                                          document.getElementById("child10").innerHTML = arr[prev3]; 
                                          document.getElementById("child11").innerHTML = arr[prev2]; 
                                          document.getElementById("child12").innerHTML = arr[prev1]; 
                                          document.getElementById("child13").innerHTML = arr[topindex]; 
                                          document.getElementById("child14").innerHTML = arr[(topindex+1)%len]; 
                                          document.getElementById("child15").innerHTML = arr[(topindex+2)%len];    
                                         document.getElementById("child16").innerHTML =  arr[(topindex+3)%len];   
                                                                                             
                                   resetAnim();
   }


function resetAnim()
{
  document.getElementById("child11").style.visibility = "visible";
  document.getElementById("child12").style.visibility = "visible";
  document.getElementById("child13").style.visibility = "visible"
  document.getElementById("child14").style.visibility = "visible";
  document.getElementById("child15").style.visibility = "visible";

 $("#child1").animate({top: '10vw',opacity:0.1});  
 $("#child2").animate({top: '20vw',opacity:0.3});  
 $("#child3").animate({top: '30vw',opacity:1.0});  
 $("#child4").animate({top: '40vw',opacity:0.3});  
 $("#child5").animate({top: '50vw',opacity:0.1});  
$("#child6").animate({top: '60vw',opacity:0});

/*
 $("#child2").animate({top: '20vw',opacity:0.3});  
 $("#child3").animate({top: '30vw',opacity:1.0});  
 $("#child4").animate({top: '40vw',opacity:0.3});  
 $("#child5").animate({top: '50vw',opacity:0});  
 */
 
 $(child6).promise().done(setVisible);
}

function setVisible()
{    document.getElementById("child1").style.visibility = "visible";
      document.getElementById("child2").style.visibility = "visible";
      document.getElementById("child3").style.visibility = "visible";				     
      document.getElementById("child4").style.visibility = "visible";
      document.getElementById("child5").style.visibility = "visible";
      document.getElementById("child6").style.visibility = "visible";

  document.getElementById("child11").style.visibility = "hidden"; 
  document.getElementById("child12").style.visibility = "hidden";
  document.getElementById("child13").style.visibility = "hidden"
  document.getElementById("child14").style.visibility = "hidden";
  document.getElementById("child15").style.visibility = "hidden";
//document.getElementById("child16").style.visibility = "hidden";
  animrunning=0;

/// 
}
function nextChar(c) {
    return String.fromCharCode(c.charCodeAt(0) + 1);
}

function isDigit(val) {
  return String(+val).charAt(0) == val;
}

function IncrementAlphanumeric(roll)
{ an = roll.split("");
  i = an.length - 1;

 while (true)
        {  // if(an[i]<'0' || an[i]>'9') return new String(an);
             if (!isDigit(an[i]))  { window.alert("!digit"); return an.join("");}

            if (i <0)   { window.alert("Maxed out number"); return;}
             
//             an[i]++;

            if (an[i] == '9')
            {
                an[i] = '0';
                i--;
                continue;
            }
          an[i]=nextChar(an[i]);

            return an.join("");
        }
}

/// this micro 1px left-right animation is required to flush first digit from browser buffer
///without this animation first digit display is delayed sometimes till second digit is entered.
/// animation forces browser to display first digit it immediately.
function flash()
{
 $(document).ready(function() {
                                       $('#child3').animate({
                       			left : "19vw"
  					}, 1)
				$('#child3').animate({
                       			left: "20vw"
  					}, 1)
						
					});
}

function InitRoll()
{


                                          ///initialise roll number display
  //                        window.alert('s');                
                                          len=arr.length;
                                          document.getElementById("child1").innerHTML = arr[len-2]; 
                                          document.getElementById("child2").innerHTML = arr[len-1]; 
                                          document.getElementById("child3").innerHTML = arr[topindex]; 
                                          document.getElementById("child4").innerHTML = arr[topindex+1]; 
                                          document.getElementById("child5").innerHTML = arr[topindex+2];    
//window.alert('e');
                                        
                                          document.getElementById("child11").innerHTML = arr[len-2]; 
                                          document.getElementById("child12").innerHTML = arr[len-1]; 
                                          document.getElementById("child13").innerHTML = arr[topindex]; 
                                          document.getElementById("child14").innerHTML = arr[topindex+1]; 
                                          document.getElementById("child15").innerHTML = arr[topindex+2];                      


flash();
}


</script>
<style>

:root
{ font-size:6vw;
}

.c0 {
 position: absolute;
  height: 25vw;
  width: 60vw;
  top: 0vw;
  left:20vw;
  visibility:hidden;
}



.c1 {
 position: absolute;
  height: 25vw;
  width: 60vw;
  top:10vw;
  left:20vw;
  opacity:0.1;
}

.c2 {
 position: absolute;
  height: 25vw;
  width: 60vw;
  top:20vw;
  left:20vw;
  opacity:0.3;
}
.c3{
 position: absolute;
  height: 25vw;
  width: 60vw;
  top:30vw;
  left:20vw;
 opacity:1.0;  
}

.c4{
 position: absolute;
  height: 25vw;
  width: 60vw;
  top:40vw;
  left:20vw;
  opacity:0.3;  
}

.c5{
 position: absolute;
  height: 25vw;
  width: 60vw;
  top:50vw;
  left:20vw;
  opacity:0.1;
}

.c6{
 position: absolute;
  height: 25vw;
  width: 60vw;
  top:60vw;
  left:20vw;
  opacity:0;
}


   </style>
</head>  
<body>  
<button style="font-size:5vw;">Start Animation</button>  

<div class=c0 id="child0">Number 09</div>
<div class=c1 id="child1">Number 10</div>
<div class=c2  id="child2">Number 11</div>
 <div class=c3 id="child3">Number 12</div>
<div class=c4  id="child4">Number 13</div>
<div class=c5  id="child5">Number 14</div>
<div class=c6  id="child6">Number 15</div>

<div class=c0 id="child10">Number 09</div>
<div class=c1 id="child11">Number 10</div>
<div class=c2  id="child12">Number 11</div>
 <div class=c3 id="child13">Number 12</div>
<div class=c4  id="child14">Number 13</div>
<div class=c5  id="child15">Number 14</div>
<div class=c6  id="child16">Number 15</div>

</body>  
</html>  

